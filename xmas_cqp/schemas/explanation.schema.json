{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "XMAS-CQP Model Decision Explanation Schema",
  "description": "Schema for model-centric explanations describing why a prediction was produced, based strictly on model-visible input features.",
  "type": "object",
  "additionalProperties": false,

  "required": [
    "explanation_structure",
    "prediction",
    "confidence",
    "summary",
    "key_factors"
  ],

  "properties": {
    "explanation_structure": {
      "type": "string",
      "enum": ["model-centric"],
      "description": "Explanation paradigm identifier (fixed for XMAS-CQP)."
    },

    "prediction": {
      "type": "string"
    },

    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0
    },

    "summary": {
      "type": "string",
      "minLength": 1,
      "maxLength": 1000
    },

    "key_factors": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,

        "required": [
          "feature",
          "value",
          "direction",
          "rank",
          "importance",
          "rationale"
        ],

        "properties": {
          "feature": {
            "type": "string"
          },

          "value": {},

          "direction": {
            "type": "string",
            "enum": [
              "increases_risk",
              "decreases_risk",
              "neutral"
            ]
          },

          "rank": {
            "type": "integer",
            "minimum": 1,
            "description": "Relative importance rank (1 = most important)."
          },

          "importance": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 1.0,
            "description": "Normalized importance score."
          },

          "rationale": {
            "type": "string",
            "minLength": 1,
            "maxLength": 1000
          }
        }
      }
    },

    "counterfactual_hint": {
      "type": "string",
      "minLength": 1,
      "maxLength": 1000
    }
  }
}
